# Config for flashing STM32F0x using Raspberry Pi 5 (linuxgpiod)
# Overrides standard target events to avoid "adapter speed" errors.

# Source the interface config. 
# We assume this file is in the same directory or search path.
source [find raspberrypi.cfg]

# Source the standard target config
source [find target/stm32f0x.cfg]

# The linuxgpiod driver does not support "adapter speed" or "adapter_khz" commands.
# Standard STM32 target configs often try to change speed during reset events.
# We override these events to do nothing (or just avoid the speed change).

# Hardcoded target name from standard stm32f0x.cfg
set _TARGETNAME stm32f0x.cpu

$_TARGETNAME configure -event reset-start {
    echo "Running overridden reset-start for linuxgpiod (skipping adapter speed change)"
}

$_TARGETNAME configure -event reset-init {
    echo "Running overridden reset-init for linuxgpiod"
}

# Override reset configuration to use Software Reset (AIRCR) via SWD.
# The 'raspberrypi.cfg' sets 'srst_only' on GPIO 18, but our boards use
# different reset pins (e.g., GPIO 12) managed by the Python script.
# 'reset_config none' tells OpenOCD we don't have a controllable physical 
# reset line, forcing it to use the Cortex-M software reset command instead.
reset_config none
