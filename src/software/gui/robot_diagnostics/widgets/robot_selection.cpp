#include "software/gui/robot_diagnostics/widgets/robot_selection.h"

#include "shared/constants.h"
#include "software/logger/logger.h"

void setupRobotSelection(Ui::AutoGeneratedMainWidget *widget,
                         unsigned int &robot_selection)
{
    for (unsigned int i = 0; i < MAX_ROBOTS_OVER_RADIO; i++)
    {
        widget->comboBox_robot_selection->addItem(QString::number(i));
    }

    auto on_robot_selection_changed = [&robot_selection](const QString &text) {
        bool ok;
        unsigned int combo_box_input = text.toUInt(&ok, 10);  // hex == 255, ok == true

        if (!ok)
        {
            LOG(FATAL) << "Tried to set the robot selection with an invalid value: '"
                       << text.toStdString() << "'" << std::endl;
        }
        else
        {
            robot_selection = combo_box_input;
        }
    };

    QWidget::connect(widget->comboBox_robot_selection, &QComboBox::currentTextChanged,
                     on_robot_selection_changed);
}
